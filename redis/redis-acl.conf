# Arturo Redis ACL Configuration
#
# Load with: redis-server --aclfile /path/to/redis-acl.conf
# Or in redis.conf: aclfile /path/to/redis-acl.conf
#
# Channel permissions use &channel syntax (Redis 7+).
# Key permissions use ~key syntax.
#
# IMPORTANT: Change all passwords before deploying to the lab network.

# ============================================================================
# Controller - Full access to all Arturo keys and channels
# ============================================================================
user controller on >controller-change-me ~commands:* ~responses:* ~device:*:alive ~events:* &events:* +@all

# ============================================================================
# Station users - Scoped per station
#
# Each station can:
#   - Read its own command stream (XREAD, XACK)
#   - Write to any response stream (XADD)
#   - Publish heartbeats (PUBLISH events:heartbeat)
#   - Publish/subscribe E-stop (PUBLISH/SUBSCRIBE events:emergency_stop)
#   - Manage its own presence key (SET/GET/DEL device:{instance}:alive)
#
# Each station CANNOT:
#   - Read other stations' command streams
#   - Read/write arbitrary keys
#   - Use admin commands (CONFIG, DEBUG, SHUTDOWN, etc.)
# ============================================================================

# DMM station (TCP bridge for SCPI instruments like Fluke 8846A, Keysight 34461A)
user dmm-station-01 on >dmm01-change-me ~commands:dmm-station-01 ~responses:* ~device:dmm-station-01:alive &events:heartbeat &events:emergency_stop +xread +xreadgroup +xack +xadd +publish +subscribe +psubscribe +set +get +del +ping +auth +select +info

# PSU station (TCP bridge for power supplies like Rigol DP832)
user psu-station-01 on >psu01-change-me ~commands:psu-station-01 ~responses:* ~device:psu-station-01:alive &events:heartbeat &events:emergency_stop +xread +xreadgroup +xack +xadd +publish +subscribe +psubscribe +set +get +del +ping +auth +select +info

# Relay controller station (GPIO relay board)
user relay-board-01 on >relay01-change-me ~commands:relay-board-01 ~responses:* ~device:relay-board-01:alive &events:heartbeat &events:emergency_stop +xread +xreadgroup +xack +xadd +publish +subscribe +psubscribe +set +get +del +ping +auth +select +info

# Serial bridge station (UART devices: Omega CN7500, CTI pumps)
user serial-bridge-01 on >serial01-change-me ~commands:serial-bridge-01 ~responses:* ~device:serial-bridge-01:alive &events:heartbeat &events:emergency_stop +xread +xreadgroup +xack +xadd +publish +subscribe +psubscribe +set +get +del +ping +auth +select +info

# E-stop station (dedicated emergency stop button)
user estop-01 on >estop01-change-me ~commands:estop-01 ~responses:* ~device:estop-01:alive &events:heartbeat &events:emergency_stop +xread +xreadgroup +xack +xadd +publish +subscribe +psubscribe +set +get +del +ping +auth +select +info

# Spare station slot
user station-06 on >spare06-change-me ~commands:station-06 ~responses:* ~device:station-06:alive &events:heartbeat &events:emergency_stop +xread +xreadgroup +xack +xadd +publish +subscribe +psubscribe +set +get +del +ping +auth +select +info

# ============================================================================
# Monitor tool - Read-only access to everything (no writes except ping/auth)
# ============================================================================
user monitor on >monitor-change-me ~commands:* ~responses:* ~device:*:alive ~events:* &events:* +xread +xrange +xrevrange +xlen +xinfo +xpending +subscribe +psubscribe +get +keys +scan +ttl +exists +ping +auth +select +info

# ============================================================================
# Disable default user (require authentication)
# ============================================================================
user default off
